#!/bin/bash
# Zed Editor Installation Script for Arch Linux + Hyprland
# This script installs Zed and all required dependencies

set -e  # Exit on error

echo "================================================"
echo "Zed Editor Installation Script"
echo "For Arch Linux + Hyprland"
echo "================================================"
echo ""

# Check if running as root
if [ "$EUID" -eq 0 ]; then
   echo "ERROR: Do not run this script as root!"
   exit 1
fi

# Check if yay is installed
if ! command -v yay &> /dev/null; then
    echo "ERROR: yay is not installed!"
    echo "Install yay first with:"
    echo "  sudo pacman -S --needed git base-devel"
    echo "  git clone https://aur.archlinux.org/yay.git"
    echo "  cd yay && makepkg -si"
    exit 1
fi

echo "[1/5] Installing Vulkan support..."
sudo pacman -S --needed vulkan-icd-loader vulkan-intel vulkan-tools mesa intel-media-driver

echo ""
echo "[2/5] Installing desktop portals for Hyprland..."
sudo pacman -S --needed xdg-desktop-portal-hyprland xdg-desktop-portal gnome-keyring

echo ""
echo "[3/5] Installing Zed editor..."
yay -S --needed zed

echo ""
echo "[4/5] Verifying Vulkan installation..."
if vulkaninfo | grep -q "apiVersion"; then
    echo "âœ“ Vulkan is working!"
    vulkaninfo | grep "apiVersion" | head -1
else
    echo "Warning: Vulkan verification failed"
fi

echo ""
echo "================================================"
echo "Installation complete!"
echo "================================================"
echo ""
echo "To launch Zed, run: zed"
echo ""
echo "If this is your first time, you may need to:"
echo "  1. Restart Hyprland (or reboot)"
echo "  2. Start gnome-keyring if not already running"
echo ""

